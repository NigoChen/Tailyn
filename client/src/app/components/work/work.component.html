<!-- Grid Table -->
<div class="grid-container" [ngStyle]="{'align-items': result_List.length > 5 ? 'stretch':'start'}">
  <div class="grid-header">
    <div>#</div>
    <div>工號姓名</div>
    <div>工單</div>
    <div>機種</div>
    <div>站別</div>
    <div>數量</div>
    <div>工時</div>
    <div>工時(加)</div>
    <div>備註</div>
    <div>時間</div>
  </div>
  <div class="grid-body">
    <div *ngFor="let item of result_List; let i = index" (click)="choose(item)"
      [ngClass]="{'grid-content': true, 'grid-selected': item?.w_Id == fb_Value_Index[0]}"
      [ngStyle]="{'grid-column': win_Size ? 'span '+(item.w_Quantity | splite:null:',').length : 'span 1'}">
      <div>{{ (i+1) }}</div>
      <div placement="top" [ngbTooltip]="item.e_Name">
        {{ item.w_JobNumber }}
      </div>
      <div>
        <div *ngFor="let val of item.w_WorkOrder | splite:null:','; let y = index">
          {{ val }}
        </div>
      </div>
      <div>
        <div *ngFor="let val of item.w_Model | splite:null:','; let y = index">
          {{ val }}
        </div>
      </div>
      <div>
        <div *ngFor="let val of item.w_Stand | splite:null:','; let y = index">
          {{ val }}
        </div>
      </div>
      <div>
        <div *ngFor="let val of item.w_Quantity | splite:null:','; let y = index">
          {{ val }}

        </div>
      </div>
      <div>
        <div *ngFor="let val of item.w_BMinute | splite:null:','; let y = index">
          {{ val }}
        </div>
      </div>
      <div>
        <div *ngFor="let val of item.w_OMinute | splite:null:','; let y = index">
          {{ val }}
        </div>
      </div>
      <div>
        <div *ngFor="let val of item.w_Remark | splite:null:','; let y = index">
            {{ val }}
        </div>
      </div>
      <div>
        {{ item.w_Date | date: 'yyyy-MM-dd' }}
      </div>
    </div>
  </div>
</div>
<!-- <div class="table-responsive table-scrollbar">
  <table class="table table-bordered table-sm">
    <thead class="thead-dark">
      <tr align="center">
        <th scope="col">工號姓名</th>
        <th scope="col">一般工時</th>
        <th scope="col">加班工時</th>
        <th scope="col">工單</th>
        <th scope="col">機種</th>
        <th scope="col">站別</th>
        <th scope="col">數量</th>
        <th scope="col">備註</th>
        <th scope="col">時間</th>
      </tr>
    </thead>
    <tbody *ngFor="let item of result_List; let i = index"
      [ngClass]="{'table-selected': item?.w_Id == fb_Value_Index[0], 'more': item.w_WorkOrder.split(',').length}" (click)="user.e_Lv > 1 && choose(item)">
      <tr align="center" *ngFor="let val of item.w_WorkOrder.split(','); let y = index">
        <td [attr.rowspan]="y" [class.d-none]="y" title="{{ item.w_JobNumber }} {{ item.e_Name }}">
            {{ item.w_JobNumber }} {{ item.e_Name }}
        </td>
        <td [attr.rowspan]="y" [class.d-none]="y" [ngClass]="[item.w_BTotal < 0 ? 'text-danger':'text-truncate']" title="{{ item.w_BTotal }}分 | 已扣除{{ item.w_BDeduct }}">
          {{ item.w_BTotal }}分 | 已扣除{{ item.w_BDeduct }}
        </td>
        <td [attr.rowspan]="y" [class.d-none]="y" [ngClass]="[item.w_OTotal < 0 ? 'text-danger ':'text-truncate']" title="{{ item.w_OTotal }}分 | 已扣除{{ item.w_ODeduct }}">
            {{ item.w_OTotal }}分 | 已扣除{{ item.w_ODeduct }}
        </td>
        <td>{{ item.w_WorkOrder | splite:y }}</td>
        <td>{{ item.w_Model | splite:y }}</td>
        <td>{{ item.w_Stand | splite:y }} {{item.s_Title}}</td>
        <td>{{ item.w_Quantity | splite:y }}</td>
        <td class="text-break">{{ item.w_Remark | splite:y }}</td>
        <td *ngIf="!y" [attr.rowspan]="y">
          <span *ngIf="!y">
            {{ item.w_Date | date: 'yyyy-MM-dd' }}
          </span>
        </td>
      </tr>
    </tbody>
  </table>
</div> -->
<!-- /Grid Table -->

<!-- Pagination -->
<ng-container *ngIf="result_Data.length > pageSize">
  <div class="d-flex justify-content-center pagination pagination-sm mt-2">
    <ngb-pagination [collectionSize]="result_Data.length" [(page)]="page" [pageSize]="pageSize" [maxSize]="100"
      [rotate]="true" [boundaryLinks]="true" (pageChange)="refreshResult_List()"></ngb-pagination>
  </div>
</ng-container>
<!-- /Pagination -->

<ng-template #form_>
  <!-- Form -->
  <form [formGroup]="fbGroup" #form="ngForm">
    <div class="form-row border border-dark d-flex justify-content-center mb-1 pt-1 pb-1">
      <div class="input-group input-group-sm col d-flex justify-content-center">
        <div class="input-group-prepend" style="pointer-events: none;">
          <!-- Label -->
          <span class="input-group-text bg-white text-truncate d-inline-block input-group-span"
            [class.text-danger]="fb_Value['w_OTotal'].value < 0 || errorValidators['w_OTotal'].length">
            {{ fb_Value['w_OTotal'].value }}
          </span>
          <!-- Label -->
          <span class="input-group-text bg-white">工時(加)</span>
        </div>
      </div>
      <div class="input-group input-group-sm col d-flex justify-content-center">
        <div class="input-group-prepend" style="pointer-events: none;">
          <!-- BTotal -->
          <span class="input-group-text bg-white text-truncate d-inline-block input-group-span"
            [class.text-danger]="fb_Value['w_BTotal'].value < 0 || errorValidators['w_BTotal'].length">
            {{ fb_Value['w_BTotal'].value }}
          </span>
          <span class="input-group-text bg-white">工時</span>
        </div>
      </div>
      <!-- Date -->
      <div class="input-group input-group-sm col-5">
        <div class="input-group-prepend">
          <input type="date" id="w_Date" class="form-control form-control-sm" [value]="fb_Value['w_Date'].value"
            (input)="onDate($event.target)">
          <span class="input-group-text bg-white" [class.text-danger]="errorValidators['w_Date'].length">{{
            errorValidators['w_Date'].length ? errorValidators['w_Date'] : "日期" }}</span>
        </div>
      </div>
    </div>
    <!-- FormArray -->
    <div class="items-scroll">
      <div class="form-row border border-dark d-flex flex-rows justify-content-center text-center ml-0 mr-0"
        *ngFor="let val of [].constructor(fb_Value['w_WorkOrder'].value.length); let i = index;">
        <div class="form-row col-12 position-relative">
          <!-- workOrder -->
          <div class="form-group col mb-1" formArrayName="w_WorkOrder">
            <label [class.text-danger]="errorValidators['w_WorkOrder'][i].length && true">
              {{ errorValidators['w_WorkOrder'][i].length ? errorValidators['w_WorkOrder'][i] : "工單" }}
            </label>
            <input type="text" class="form-control form-control-sm" [formControlName]="i" placeholder="工單"
              (blur)="inputValidators(fbGroup, 'w_WorkOrder')">
          </div>
          <!-- Model -->
          <div class="form-group col mb-1" formArrayName="w_Model">
            <label [class.text-danger]="errorValidators['w_Model'][i].length && true">
              {{ errorValidators['w_Model'][i].length ? errorValidators['w_Model'][i] : "機種" }}
            </label>
            <input type="text" class="form-control form-control-sm" [formControlName]="i" placeholder="機種"
              (blur)="inputValidators(fbGroup, 'w_Model')">
          </div>
          <!-- Icon Btn Group -->
          <div class="form-icon-group">
            <!-- Badge Number -->
            <b class="text-dark">{{i+1}}</b>
            <!-- Icon Button -->
            <i [ngClass]="['bi', i>0 ? 'text-danger bi-dash-square' : 'text-info bi-plus-square']"
              [title]="i>0 ? '刪除':'新增'" (click)="update_FormArray(i)">
            </i>
          </div>
        </div>

        <!-- OMinute -->
        <div class="form-group col-2 mb-1" formArrayName="w_OMinute"
          *ngIf="fb_Value['w_OCheckBox'].get(''+i).value; else BMinute">
          <label [class.text-danger]="errorValidators['w_OMinute'][i].length && true">
            {{ errorValidators['w_OMinute'][i].length ? errorValidators['w_OMinute'][i] : "加工時" }}
          </label>
          <input type="number" class="form-control form-control-sm" step="10" min="0" max="900" [formControlName]="i"
            (blur)="inputValidators(fbGroup, 'w_OMinute', i)" (change)="onChange('w_OMinute')">
        </div>

        <ng-template #BMinute>
          <!-- BMinute -->
          <div class="form-group col-2 mb-1" formArrayName="w_BMinute">
            <label [class.text-danger]="errorValidators['w_BMinute'][i].length && true">
              {{ errorValidators['w_BMinute'][i].length ? errorValidators['w_BMinute'][i] : "工時" }}
            </label>
            <input type="number" class="form-control form-control-sm" step="10" min="0" max="900" [formControlName]="i"
              (blur)="inputValidators(fbGroup, 'w_BMinute', i)" (change)="onChange('w_BMinute')">
          </div>
        </ng-template>

        <!-- Checkbox -->
        <div class="form-group col-2 mb-1" formArrayName="w_OCheckBox">
          <label>加班</label>
          <input type="checkbox" class="form-control form-control-sm" [formControlName]="i"
            (change)="onChange('w_OCheckBox', i)">
        </div>

        <!-- Quantity -->
        <div class="form-group col-2 mb-1" formArrayName="w_Quantity">
          <label [class.text-danger]="errorValidators['w_Quantity'][i].length && true">
            {{ errorValidators['w_Quantity'][i].length ? errorValidators['w_Quantity'][i] : "數量" }}
          </label>
          <input type="number" class="form-control form-control-sm" step="1" min="0" max="99" [formControlName]="i"
            (blur)="inputValidators(fbGroup, 'w_Quantity', i)">
        </div>

        <!-- Stand -->
        <div class="form-group col mb-1" formArrayName="w_Stand">
          <label [class.text-danger]="errorValidators['w_Stand'][i].length && true">
            {{ errorValidators['w_Stand'][i].length ? errorValidators['w_Stand'][i] : "站別" }}
          </label>
          <select class="form-control form-control-sm" [formControlName]="i"
            (blur)="inputValidators(fbGroup, 'w_Stand')">
            <option *ngFor="let item of client_List$ | async;" [value]="item.c_Stand_Code+' '+item.c_Stand">
              {{ item.c_Stand_Code }} {{ item.c_Stand }}
            </option>
          </select>
        </div>

        <!-- Remark -->
        <div class="form-group col-12 mb-1" formArrayName="w_Remark">
          <label [class.text-danger]="errorValidators['w_Remark'][i].length && true">
            {{ errorValidators['w_Remark'][i] ? errorValidators['w_Remark'][i] : "備註" }}
          </label>
          <input type="text" class="form-control form-control-sm" [formControlName]="i" placeholder="備註"
            (blur)="inputValidators(fbGroup, 'w_Remark')">
        </div>
      </div>
    </div>
  </form>
  <!-- /Form -->
</ng-template>